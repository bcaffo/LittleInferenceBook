---
output:
  html_document:
    toc: yes
---
<!--pandoc
toc:
toc-depth: 2
from: markdown-implicit_figures+autolink_bare_uris+ascii_identifiers+tex_math_single_backslash
template: ./scripts/rstudio-default.tex
highlight-style: tango
-->

```{r echo = FALSE, message=FALSE}
# Options for book knitting
knitr::opts_chunk$set(fig.path = "LeanPub/images/",
                      chunk_hook = TRUE)
```


```{r echo = FALSE, message=FALSE}
# knitr hook to process the book into pdf
knitr::knit_hooks$set(document = function(x) {
  # Remove $$ from explicit equation environments 
  x <- gsub(pattern = "[$]{2}[\n ]*([\\]begin[^$]*)[$]{2}",
            replacement = "\\1",
            x = x)
})

# Set of knitr chunk hooks to capture output for LeanPub publishing
knitr::knit_hooks$set(chunk = function(x, options) {
  # Use hook only if asked for (complete files, i.e. first level chunks)
  if(options$chunk_hook){
    # Capture output for LeanPub publishing
    leanpub <- x
    
    # Fix equation markup
    leanpub <- gsub(pattern = paste0("([^[:alnum:]])",
                                     "[$]{1,2}([^$]*)[$]{1,2}",
                                     ""),
                    replacement = "\\1{$$}\\2{/$$}\\3",
                    x = leanpub)
    
    # Fix titled code chunk markup
    leanpub <- gsub(pattern = paste("(\\\\vspace[{]1pc[}]\\\\verb;([^;]*);[[:space:]]*)?",
                                    "[`]{3}r?([^`]*)[`]{3}", sep = ""),
                    replacement = paste("{title=\"\\2\", lang=r, line-numbers=off}",
                                        "~~~\\3~~~", sep = "\n"),
                    x = leanpub)
    leanpub <- gsub(pattern = "title=\"\",? ?",
                    replacement = "",
                    x = leanpub)
    
    # Fix image paths
    leanpub <- gsub(pattern = "(![[][^[]*[]][(])LeanPub/([^)]*[)])",
                    replacement = "\\1\\2",
                    x = leanpub)
    
    # Export LeanPub compatible markdown
    cat(leanpub, file = paste0("LeanPub/", options$label, ".md"))
  } else {
    # Second level chunks (i.e. chunks inside manuscript files)
    # Add title to {r title="labeled-chunks"}
    if(options$title != ""){
      x <- paste("\\vspace{1pc}\\verb;", options$title, ":;\n", x, sep = "")
    }
  }
  x
})
```

\newpage

```{r preface, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/preface.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 01_introduction, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/01_introduction.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 02_probability, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/02_probability.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 03_conditional, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/03_conditional.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 04_expectations, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/04_expectations.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 05_variation, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/05_variation.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 06_common, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/06_common.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 07_asymptotics, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/07_asymptotics.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 08_tcis, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/08_tcis.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 09_ht, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/09_ht.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 10_pvalues, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/10_pvalues.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 11_power, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/11_power.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

\newpage

```{r 13_bootstrapping, echo = FALSE, results='asis', warning=FALSE, message=FALSE, fig.keep='none'}
cat(knitr::knit_child("./manuscript/13_bootstrapping.Rmd", quiet = TRUE, options = list(chunk_hook=FALSE, title="")))
```

